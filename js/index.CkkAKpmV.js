(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const l of n)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function t(n){const l={};return n.integrity&&(l.integrity=n.integrity),n.referrerPolicy&&(l.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?l.credentials="include":n.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function a(n){if(n.ep)return;n.ep=!0;const l=t(n);fetch(n.href,l)}})();const O=location.protocol.startsWith("file"),F={minLat:16.5,maxLat:20.5,minLon:97.5,maxLon:103},Y=[[F.minLat,F.minLon],[F.maxLat,F.maxLon]],z={fast:"rgba(0, 140, 60, 1)",moderate:"rgba(255, 179, 0, 1)",slow:"rgba(255, 40, 40, 1)",veryTechnical:"rgba(128, 0, 128, 1)",paved:"rgba(61, 96, 203, 1)",maybe:"rgba(180, 180, 180, 1)",likely:"rgba(100, 100, 100, 1)"},Z=[{max:7,color:"rgba(128, 0, 128, 1)"},{max:15,color:"rgba(255, 40, 40, 1)"},{max:30,color:"rgba(255, 179, 0, 1)"},{max:null,color:"rgba(0, 140, 60, 1)"}],U=1753629478723,X=9,J=13,j="UmlkZVNhZmUyMDI1IQ==",Q="rident_auth",ae=30*24*60*60*1e3;function re(){const e=localStorage.getItem(Q);if(!e)return!1;try{const{password:o,expires:t}=JSON.parse(e);return o===j&&Date.now()<t}catch{return!1}}function se(){const e=Date.now()+ae;localStorage.setItem(Q,JSON.stringify({password:j,expires:e}))}function K(){re()||(prompt("Enter password to view the map:")!==atob(j)?(alert("Incorrect password. Access denied."),document.body.innerHTML="<h2 style='text-align:center;margin-top:20%'>Access Denied</h2>"):se()),document.body.classList.remove("locked")}const I=L.tileLayer(O?`../../tiles/heatmap/ride/{z}/{x}/{y}.png?ts=${U}`:`https://julcnx.github.io/tiles/heatmap/ride/{z}/{x}/{y}.png?ts=${U}`,{tileSize:256,minNativeZoom:X,maxNativeZoom:J,zIndex:10,attribution:O?"Ride NT (Dev)":"Ride NT",id:"ride-nt"}),W=L.tileLayer(`https://julcnx.github.io/tiles/heatmap/ride/{z}/{x}/{y}.png?ts=${U}`,{tileSize:256,minNativeZoom:X,maxNativeZoom:J,zIndex:10,attribution:"Ride NT",id:"ride-nt-alt"});function G(e,o){return L.tileLayer.wms("https://gisportal.drr.go.th/portal/sharing/servers/aa5fdea8d96542d49d3d8731d77458b7/rest/services/GISBaseMaps/DRR_Dynamic/MapServer/export",{transparent:!0,attribution:e,format:"png",layers:o,bboxSR:102100,f:"image",className:"overlay"})}const ie={all:G("DRR (All)","show:1,2,3,4,5,6,7"),highways:G("DRR (Highways)","show:-1,-1,-1,3"),majorHighways:G("DRR (Highways Major)","show:-1,-1,-1,2"),ruralRoads:G("DRR (Rural Roads)","show:-1,-1,-1,7")},q={satellite:"s",terrain:"p",hybrid:"h",maps:"m"},le=L.tileLayer(`https://mt{s}.google.com/vt?lyrs=${q.satellite}&x={x}&y={y}&z={z}`,{subdomains:["0","1","2","3"],maxNativeZoom:18,attribution:"Google Satellite",id:"google-satellite"}),ce=L.tileLayer(`https://mt{s}.google.com/vt?lyrs=${q.maps}&x={x}&y={y}&z={z}`,{subdomains:["0","1","2","3"],maxNativeZoom:18,attribution:"Google Maps",id:"google-maps"}),de=L.tileLayer(`https://mt{s}.google.com/vt?lyrs=${q.terrain}&x={x}&y={y}&z={z}`,{subdomains:["0","1","2","3"],maxNativeZoom:18,attribution:"Google Terrain",id:"google-terrain"}),pe=L.tileLayer(`https://mt{s}.google.com/vt?lyrs=${q.hybrid}&x={x}&y={y}&z={z}`,{subdomains:["0","1","2","3"],maxNativeZoom:18,transparent:!0,zIndex:2,attribution:"Google Hybrid",id:"google-hybrid"}),ue=L.esri.basemapLayer("ImageryFirefly",{maxNativeZoom:18,attribution:"ESRI Firefly",id:"esri-firefly"}),ye=L.esri.basemapLayer("ImageryClarity",{maxNativeZoom:17,attribution:"ESRI Clarity",id:"esri-clarity"}),me=L.tileLayer("https://wayback.maptiles.arcgis.com/arcgis/rest/services/World_Imagery/WMTS/1.0.0/default028mm/MapServer/tile/10/{z}/{y}/{x}",{maxNativeZoom:17,attribution:"ESRI Wayback",id:"esri-wayback"}),ge=L.tileLayer("https://{s}.tile.thunderforest.com/transport/{z}/{x}/{y}.png?apikey=6e5478c8a4f54c779f85573c0e399391",{attribution:"Thunderforest Transport",maxNativeZoom:18,subdomains:"abc"}),fe=L.tileLayer("https://{s}.tile.thunderforest.com/cycle/{z}/{x}/{y}.png?apikey=6e5478c8a4f54c779f85573c0e399391",{attribution:"Thunderforest Transport",maxNativeZoom:18,subdomains:"abc",id:"thunderforest-cyclemap"}),he=L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{subdomains:["a","b","c"],attribution:"OSM Contributors",id:"openstreetmap"}),be=L.tileLayer("https://services.arcgisonline.com/arcgis/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}",{attribution:"WorldTopoMap",maxNativeZoom:18,id:"worldtopomap"}),ve=L.tileLayer("../../tiles/50k/{z}/{x}/{y}.png",{attribution:"50K",minNativeZoom:13,maxNativeZoom:14,id:"50k"}),xe=L.tileLayer("../../tiles/slope/{z}/{x}/{y}.png",{attribution:"Slope",minNativeZoom:11,maxNativeZoom:11,opacity:.3,id:"slope"}),Le=L.tileLayer("https://mts{s}.googleapis.com/vt?hl=en-US&lyrs=svv|cb_client:apiv3&style=40,18&x={x}&y={y}&z={z}",{subdomains:["0","1","2","3"],maxNativeZoom:13,maxZoom:20,zIndex:1,className:"overlay",attribution:"Google Street View"}),we=L.vectorGrid.protobuf("https://tiles.mapillary.com/maps/vtp/mly1_public/2/{z}/{x}/{y}?access_token=MLY|4100327730013843|5bb78b81720791946a9a7b956c57b7cf",{transparent:!0,maxNativeZoom:13,zIndex:1,className:"overlay",attribution:"Mapillary",vectorTileLayerStyles:{sequence:()=>({color:"rgb(20, 150, 60)",weight:10})}}),Se=L.tileLayer("https://karta-gateway.geo.azure.myteksi.net/view/api/2.0/sequence/tiles/{x}/{y}/{z}.png",{transparent:!0,minNativeZoom:13,maxNativeZoom:20,className:"overlay",attribution:"KartaView"}),_=L.tileLayer("https://content-{s}.strava.com/identified/globalheat/all/hot/{z}/{x}/{y}.png?v=19",{subdomains:["a"],minNativeZoom:11,maxNativeZoom:13,zIndex:2,className:"overlay",attribution:"Strava Heatmap All"}),Ee=L.tileLayer(`https://{s}.gps-tile.openstreetmap.org/lines/{z}/{x}/{y}.png?ts=${U}`,{transparent:!0,maxNativeZoom:14,zIndex:9,className:"overlay",attribution:"OSM GPS Traces"}),$={"World Topo Map":be,"OSM Standard":he,"Google Maps":ce,"Google Terrain":de,"Transport Map":ge,"Cycle Map":fe};O&&($["RTS Map"]=ve);const N={"Google Satellite":le,"ESRI Firefly":ue,"ESRI Clarity":ye,"ESRI Wayback":me},w={"OpenStreetMap traces":Ee};O&&(w["Google Street View"]=Le,w["Google Hybrid"]=pe,w.Mapillary=we,w.KartaView=Se,w["Strava Heatmap"]=_,w["DRR (All)"]=ie.all,w.Slope=xe);let P=0;function Te(e){const o=L.control({position:"topleft"});o.onAdd=function(){const t=L.DomUtil.create("div","leaflet-control leaflet-top-center leaflet-control-layers leaflet-control-layers-expanded transparency-toolbar"),a=L.DomUtil.create("select","",t);a.className="transparency-select",Object.keys(N).forEach(r=>{const g=document.createElement("option");g.value=r,g.textContent=r,a.appendChild(g)});const n=localStorage.getItem("rident_satellite"),l=n&&N[n]?n:Object.keys(N)[0];a.value=l;let c=N[l];c.addTo(e),c.setOpacity(P/100),c.setZIndex(1);const s=L.DomUtil.create("input","",t);return s.className="transparency-slider",s.type="range",s.min=0,s.max=100,s.step=1,s.value=P,L.DomEvent.on(s,"input",r=>{P=parseFloat(r.target.value),c&&c.setOpacity(P/100),s.blur()}),L.DomEvent.on(a,"change",r=>{const g=r.target.value;e.hasLayer(c)&&e.removeLayer(c),c=N[g],c.addTo(e),c.setOpacity(P/100),c.setZIndex(1),localStorage.setItem("rident_satellite",g)}),L.DomEvent.disableClickPropagation(t),a.blur(),t},o.addTo(e)}const ee="rident_map_view",te="rident_base_layer",oe="rident_satellite",ne="rident_overlays";function ke(){document.getElementById("map").style.display="block";const e=Ce();De(e);const o=L.control.layers($,w,{collapsed:!0,autoZIndex:!1,position:"topright"}).addTo(e);return Me(e),Ne(e),{map:e,layersControl:o}}function Ce(){const e=L.map("map",{minZoom:9,maxBounds:L.latLngBounds(Y).pad(.3),layers:[I],zoomControl:!0,maxZoom:18,attributionControl:!0});return e.attributionControl.setPrefix(""),e}function De(e){const o=location.hash.match(/^#(\d+)\/([-\d.]+)\/([-\d.]+)$/);if(o){const a=+o[1],n=+o[2],l=+o[3];e.setView([n,l],a);return}const t=localStorage.getItem(ee);if(t)try{const{center:a,zoom:n}=JSON.parse(t);e.setView(a,n);return}catch{}e.setView([18.79,98.98],10)}function Me(e){let o;const t=localStorage.getItem(te);t&&$[t]?($[t].addTo(e),o=$[t]):($["World Topo Map"].addTo(e),o=$["World Topo Map"]);const a=localStorage.getItem(ne);let n=[];try{n=a?JSON.parse(a):[]}catch{}if(n.length)for(const[s,r]of Object.entries(w))n.includes(s)&&r.addTo(e);const l=localStorage.getItem(oe);let c;return l&&N[l]?c=N[l]:c=N["Google Satellite"],c&&(c.setOpacity(P/100),c.addTo(e)),{currentBaseLayer:o,currentSatelliteLayer:c}}function Ne(e){e.on("baselayerchange",o=>{const t=Object.entries($).find(([n,l])=>l===o.layer);t&&(localStorage.setItem(te,t[0]),t[1].setZIndex(0));const a=Object.entries(N).find(([n,l])=>l===o.layer);a&&(localStorage.setItem(oe,a[0]),a[1].setZIndex(1),a[1].setOpacity(P/100))}),e.on("overlayadd overlayremove",()=>{const o=Object.entries(w).filter(([t,a])=>e.hasLayer(a)).map(([t])=>t);localStorage.setItem(ne,JSON.stringify(o))}),e.on("moveend zoomend",()=>{const o=e.getCenter(),t=e.getZoom(),a=`#${t}/${o.lat.toFixed(6)}/${o.lng.toFixed(6)}`;location.hash=a,localStorage.setItem(ee,JSON.stringify({center:o,zoom:t}))})}function Oe(e){const o=L.control({position:"bottomright"});o.onAdd=function(){const t=L.DomUtil.create("div","info legend");t.style.position="relative",t.style.transition="all 0.3s ease",t.style.fontSize="14px",t.style.color="#333",t.style.maxWidth="250px";let a=!1;function n(d){return`<span style="
				display:inline-block;
				width:14px;
				height:10px;
				margin-right:8px;
				background-color:${d};
				vertical-align:middle;
			"></span>`}const l=document.createElement("div");l.style.background="rgba(255, 255, 255, 0.95)",l.style.borderRadius="6px",l.style.padding="8px",l.style.boxShadow="0 2px 6px rgba(0,0,0,0.2)",l.style.display="none",l.style.flexDirection="column";const c=document.createElement("div");c.style.display="flex",c.style.justifyContent="space-between",c.style.alignItems="center",c.style.marginBottom="6px";const s=document.createElement("span");s.textContent="RideNT Legend",s.style.fontWeight="bold";const r=document.createElement("a");r.href="#",r.innerHTML="🔽",r.title="Collapse legend",r.style.fontSize="18px",r.style.textDecoration="none",r.style.cursor="pointer",r.style.padding="4px",r.onclick=d=>{d.preventDefault(),a=!1,b()},c.appendChild(s),c.appendChild(r);const g=document.createElement("div");g.innerHTML=`
			${n(z.paved)} Paved<br>
			${n(z.fast)} Fast dirt<br>
			${n(z.moderate)} Moderate dirt<br>
			${n(z.slow)} Slow / Technical<br>
			${n(z.veryTechnical)} Very technical<br>
			${n(z.likely)} Rural roads<br>
			${n(z.maybe)} Uncertain trails<br>
			<br>
			<span class="caption">Speeds are approximate, based on dry GPX tracks with climate & rider factors considered. Accuracy not guaranteed.</span>
		`,l.appendChild(c),l.appendChild(g);const u=document.createElement("a");u.href="#",u.innerHTML="❓",u.title="Show legend",u.style.display="none",u.style.textDecoration="none",u.style.fontSize="20px",u.style.width="36px",u.style.height="36px",u.style.textAlign="center",u.style.lineHeight="36px",u.style.borderRadius="6px",u.style.background="white",u.style.boxShadow="0 2px 6px rgba(0,0,0,0.2)",u.style.cursor="pointer",u.onclick=d=>{d.preventDefault(),a=!0,b()};function b(){l.style.display=a?"flex":"none",u.style.display=a?"none":"inline-block"}return b(),t.appendChild(l),t.appendChild(u),t},o.addTo(e)}function H(e,o=2e3){const t=document.createElement("div");t.innerText=e,t.style.position="fixed",t.style.bottom="50px",t.style.left="50%",t.style.transform="translateX(-50%)",t.style.background="rgba(0,0,0,0.8)",t.style.color="#fff",t.style.padding="8px 12px",t.style.borderRadius="6px",t.style.fontSize="14px",t.style.zIndex=9999,t.style.opacity=0,t.style.transition="opacity 0.3s ease",document.body.appendChild(t),requestAnimationFrame(()=>{t.style.opacity=1}),setTimeout(()=>{t.style.opacity=0,setTimeout(()=>{document.body.removeChild(t)},300)},o)}function Ie(e,o){const t=document.getElementById("context-menu");function a(c,s){const r=document.createElement("div");r.innerText=c,r.style.padding="4px 8px",r.style.cursor="pointer",r.onmouseenter=()=>r.style.background="#eee",r.onmouseleave=()=>r.style.background="",r.onmousedown=()=>{s(),t.style.display="none"},t.appendChild(r)}function n(){const c=document.createElement("hr");c.style.margin="0",t.appendChild(c)}e.on("contextmenu",function(c){const s=c.latlng.lat.toFixed(6),r=c.latlng.lng.toFixed(6),g=e.getZoom(),u=Object.values($).find(d=>e.hasLayer(d)),b=Object.values(N).find(d=>e.hasLayer(d));t.innerHTML="",a("Edit in OpenStreetMap",()=>{window.open(`https://www.openstreetmap.org/id?#map=${Math.max(16,e.getZoom())}/${s}/${r}`)}),O&&a("Edit Traces in OpenStreetMap",()=>{window.open(`https://www.openstreetmap.org/id?#map=${Math.max(16,e.getZoom())}/${s}/${r}&background=Bing&overlays=osm-gps,strava-heatmap-all&disable_features=address_points,points,buildings,building_parts,indoor,landuse,boundaries,water,rail,pistes,aerialways,power,past_future,others`)}),n(),a("Open in Google Maps",()=>{const d=new URLSearchParams({api:1,map_action:"map",basemap:"terrain",center:[s,r].join(","),zoom:g});window.open(`https://www.google.com/maps/@?${unescape(d)}`)}),O&&(a("Open in Google Street View",()=>{window.open(`https://www.google.com/maps?q=&layer=c&cbll=${s},${r}`)}),a("Open in Mapillary",()=>{const d=new URLSearchParams({lat:s,lng:r,z:g});window.open(`https://www.mapillary.com/app/?${unescape(d)}`)})),a("Open in Komoot",()=>{window.open(`https://www.komoot.com/plan/@${s},${r},${g}z?sport=mtb`)}),n(),a("Search here",()=>{o(`${s}, ${r}`)}),a("Copy Coordinates",()=>{navigator.clipboard.writeText(`${s}, ${r}`).then(()=>{H("Coordinates copied to clipboard.")})}),a("Get Elevation",()=>{fetch(`https://api.open-elevation.com/api/v1/lookup?locations=${s},${r}`).then(d=>d.json()).then(d=>{if(d.results&&d.results.length>0){const p=d.results[0].elevation;H(`Elevation: ${p} meters`)}}).catch(d=>console.error("Error fetching elevation:",d))}),O&&(n(),a("Download OSM GPS traces",()=>{window.open("https://api.openstreetmap.org/api/0.6/trackpoints?bbox="+[e.getBounds().getWest(),e.getBounds().getSouth(),e.getBounds().getEast(),e.getBounds().getNorth()].join(",")+"&page=0")}),a("Generate SqliteDB",()=>{const d=e.getBounds(),p=d.getNorth().toFixed(6),f=d.getWest().toFixed(6),m=d.getSouth().toFixed(6),h=d.getEast().toFixed(6),x=`${p},${f},${m},${h}`;let i;(b==null?void 0:b.options.opacity)>0?i=`node scripts/sqlitedb.js ./tmp/${b.options.id}.sqlitedb '${b._url.replace("{s}",b.options.subdomains[0])}' ${x}`:u&&(i=`node scripts/sqlitedb.js ./tmp/${u.options.id}.sqlitedb '${u._url.replace("{s}",u.options.subdomains[0])}' ${x}`),i&&navigator.clipboard.writeText(i).then(()=>{H("Command copied to clipboard.")})})),t.style.left=c.originalEvent.pageX+"px",t.style.top=c.originalEvent.pageY+"px",t.style.display="block"});const l=()=>t.style.display="none";e.on("mousedown",l),document.addEventListener("mousedown",l)}function $e(e,o,t){const a=e.getContainer(),n=L.latLngBounds(Y);["dragenter","dragover","dragleave","drop"].forEach(s=>{a.addEventListener(s,r=>r.preventDefault(),!1)}),a.addEventListener("drop",s=>{if(s.preventDefault(),!!s.dataTransfer.files.length)for(const r of s.dataTransfer.files){if(!r.name.toLowerCase().endsWith(".gpx"))continue;const g=new FileReader;g.onload=u=>{const b=u.target.result;if(t(b))return;for(const p in w)w.hasOwnProperty(p)&&w[p]instanceof L.GeoJSON&&(o.removeLayer(w[p]),e.removeLayer(w[p]),delete w[p]);const d=l(b);if(d){const p=L.geoJSON(d,{style:m=>({color:m.properties.stroke,opacity:m.properties["stroke-opacity"],weight:m.properties["stroke-width"]}),onEachFeature:function(m,h){h.bindTooltip(`<b>Speed:</b> ${m.properties.speed} km/h<br><b>Time:</b> ${m.properties.time}`)}}).addTo(e);c(e,p);const f=p.getBounds();if(n.intersects(f)){e.fitBounds(f);const m=r.name.replace(/\.gpx$/i,"");w[m]=p,o.addOverlay(p,m)}else alert(`GPX file "${r.name}" is outside the allowed bounds and will not be displayed.`);return}},g.readAsText(r)}});function l(s){const g=new DOMParser().parseFromString(s,"text/xml"),u=g.querySelector("parsererror");if(u)return console.warn("Invalid GPX string:",u.textContent),null;function b(f,m,h,x){const y=(h-f)*Math.PI/180,v=(x-m)*Math.PI/180,E=Math.sin(y/2)**2+Math.cos(f*Math.PI/180)*Math.cos(h*Math.PI/180)*Math.sin(v/2)**2;return 6371*(2*Math.atan2(Math.sqrt(E),Math.sqrt(1-E)))}const d={type:"FeatureCollection",features:[]};let p=g.querySelectorAll("trkseg");return p.length||(p=g.querySelectorAll("rte")),p.forEach(f=>{let m=f.querySelectorAll("trkpt");m.length||(m=g.querySelectorAll("rtept"));for(let h=1;h<m.length;h++){const x=m[h-1],i=m[h],y=parseFloat(x.getAttribute("lat")),v=parseFloat(x.getAttribute("lon")),E=parseFloat(i.getAttribute("lat")),S=parseFloat(i.getAttribute("lon"));if([y,v,E,S].some(isNaN))continue;let k=null;const C=x.querySelector("time"),D=i.querySelector("time");if(C&&D)try{const M=new Date(C.textContent),V=(new Date(D.textContent)-M)/(1e3*3600);V>0&&(k=b(y,v,E,S)/V)}catch{k=null}const R=(k===null?{color:z.likely}:Z.find(M=>k<=M.max)||Z[Z.length-1]).color,B=[[v,y],[S,E]];d.features.push({type:"Feature",geometry:{type:"LineString",coordinates:B},properties:{baseSpeed:k??null,speed:k?k.toFixed(2):null,time:C?C.textContent:null,stroke:R,"stroke-opacity":.8,"stroke-width":7}})}}),d.features.length>0?d:null}function c(s,r){if(document.getElementById("speed-multiplier"))return;const g=L.control({position:"topright"});g.onAdd=function(d){const p=L.DomUtil.create("div","leaflet-bar");return p.style.background="white",p.style.padding="6px 10px",p.style.fontSize="14px",p.style.lineHeight="1.2",p.style.minWidth="160px",p.innerHTML=`
        <label>
          Speed ÷ <span id="multiplier-val">1.00</span><br/>
          <input id="speed-multiplier" type="range" min="0.1" max="2" step="0.01" value="1" style="width: 140px;" />
        </label>
      `,L.DomEvent.disableClickPropagation(p),p},g.addTo(s);const u=document.getElementById("speed-multiplier"),b=document.getElementById("multiplier-val");u.addEventListener("input",d=>{const p=parseFloat(d.target.value);b.textContent=p.toFixed(2),r.eachLayer(f=>{const m=f.feature.properties.baseSpeed;if(m==null)return;const h=m/p;f.feature.properties.speed=h.toFixed(2);const i=(Z.find(y=>h<=y.max)||Z[Z.length-1]).color;f.setStyle({color:i}),f.setTooltipContent(`<b>Speed:</b> ${h.toFixed(2)} km/h<br><b>Time:</b> ${f.feature.properties.time}`)})})}}function Re(e){const o=document.querySelector(".leaflet-overlay-pane");function t(){const s=document.getElementById("map");I.options.opacity===1?(I.setOpacity(0),o.style.opacity=0,s.classList.remove("hide-overlays")):(I.setOpacity(1),o.style.opacity=1)}function a(s=!1){const r=document.getElementById("map");r.classList.contains("hide-overlays")?(r.classList.remove("hide-overlays"),I.setOpacity(1)):(r.classList.toggle("hide-overlays"),I.setOpacity(s?0:1))}function n(){const s=document.querySelector(".transparency-slider");if(!s)return;const r=parseInt(s.value,10);s.value=r===100?"0":"100",s.dispatchEvent(new Event("input",{bubbles:!0}))}function l(){O&&(e.hasLayer(I)?(e.removeLayer(I),e.addLayer(W)):e.hasLayer(W)&&(e.removeLayer(W),e.addLayer(I)))}function c(){O&&(e.hasLayer(_)?e.removeLayer(_):e.addLayer(_))}document.addEventListener("keydown",s=>{const r=document.activeElement;r&&(r.tagName==="INPUT"||r.tagName==="TEXTAREA"||r.isContentEditable)||(s.key.toLowerCase()==="a"?a(!0):s.key.toLowerCase()==="q"?a(!1):s.key.toLowerCase()==="w"?t():s.key.toLowerCase()==="s"?n():s.key==="Delete"?(localStorage.clear(),location.reload()):s.key.toLowerCase()==="e"?l():s.key.toLowerCase()==="x"&&c())})}const T=[];function ze(e){let o=null,t=!1,a=!1,n=null;const l=i=>{const y=i.getZoom();return{color:"yellow",weight:Math.max(4,25-(18-y)*2),opacity:.3}},c=L.control({position:"bottomleft"});c.onAdd=function(){const i=L.DomUtil.create("div","leaflet-bar leaflet-control"),y=L.DomUtil.create("a","",i);y.href="#",y.innerHTML="🖊️",y.title="Toggle highlighter",y.style.padding="6px 10px",y.style.fontSize="20px";const v=L.DomUtil.create("a","",i);v.href="#",v.innerHTML="🧽",v.title="Clear highlights",v.style.padding="6px 10px",v.style.fontSize="20px",n=L.DomUtil.create("a","",i),n.href="#",n.innerHTML="⬇️",n.title="Download GPX",n.style.padding="6px 10px",n.style.fontSize="20px",n.classList.add("leaflet-disabled"),n.style.opacity="0.3",n.style.pointerEvents="none",y.onclick=S=>{S.preventDefault(),t=!t,t||(o=null,a=!1),E(),t||r()},v.onclick=S=>{S.preventDefault(),T.forEach(k=>e.removeLayer(k)),T.length=0,o=null,a=!1,m()},n.onclick=S=>{S.preventDefault(),n.classList.contains("leaflet-disabled")||x()},L.DomEvent.disableClickPropagation(i),L.DomEvent.disableScrollPropagation(i);function E(){t?(y.style.background="#ff0",y.style.color="black"):(y.style.background="white",y.style.color="")}return i},c.addTo(e);function s(){e.dragging.disable(),e.doubleClickZoom.disable(),e.boxZoom.disable(),e.scrollWheelZoom.disable()}function r(){e.dragging.enable(),e.doubleClickZoom.enable(),e.boxZoom.enable(),e.scrollWheelZoom.enable()}function g(i){return i.latlng?i.latlng:i.touches&&i.touches.length>0?e.containerPointToLatLng(e.mouseEventToContainerPoint(i.touches[0])):null}function u(i){if(!t)return;const y=g(i);y&&(a||(a=!0,s(),o?o.addLatLng(y):(o=L.polyline([y],l(e)).addTo(e),T.push(o))),i.preventDefault&&i.preventDefault())}function b(i){if(!t||!a||!o)return;const y=g(i);y&&(o.addLatLng(y),i.preventDefault&&i.preventDefault())}function d(i){t&&a&&(a=!1,m(),r()),i.preventDefault&&i.preventDefault()}e.on("mousedown",u),e.on("mousemove",b),e.on("mouseup",d);const p=e.getContainer();p.addEventListener("touchstart",u,{passive:!0}),p.addEventListener("touchmove",b,{passive:!0}),p.addEventListener("touchend",d,{passive:!0}),e.on("zoomend",()=>{T.forEach(i=>i.setStyle(l(e)))}),window.addEventListener("keydown",i=>{if(i.key.toLowerCase()==="d"&&(t=!t,t||(o=null,a=!1),f(),t||r()),(i.ctrlKey||i.metaKey)&&i.key.toLowerCase()==="z"&&T.length>0){const y=T.pop();e.removeLayer(y),o===y&&(o=null,a=!1),saveToUrl(),m()}});function f(){const i=document.querySelector('.leaflet-bar a[title="Toggle highlighter"]');i&&(t?(i.style.background="#ff0",i.style.color="black"):(i.style.background="white",i.style.color=""))}function m(){n&&(T.length?(n.classList.remove("leaflet-disabled"),n.style.opacity="1",n.style.pointerEvents="auto"):(n.classList.add("leaflet-disabled"),n.style.opacity="0.3",n.style.pointerEvents="none"))}function h(i){try{const v=new DOMParser().parseFromString(i,"text/xml"),E=v.querySelector("parsererror");if(E)return console.warn("Invalid GPX string:",E.textContent),!1;const S=v.querySelector("gpx");if(!S||S.getAttribute("creator")!=="MapDrawer")return!1;if(T.forEach(C=>e.removeLayer(C)),T.length=0,o=null,t=!1,v.querySelectorAll("trkseg").forEach(C=>{const D=[];if(C.querySelectorAll("trkpt").forEach(R=>{const B=parseFloat(R.getAttribute("lat")),M=parseFloat(R.getAttribute("lon"));!isNaN(B)&&!isNaN(M)&&D.push(L.latLng(B,M))}),D.length>0){const R=L.polyline(D,l(e)).addTo(e);T.push(R)}}),T.length>0){const C=T.flatMap(D=>D.getLatLngs());e.fitBounds(L.latLngBounds(C))}return m(),!0}catch(y){console.warn("Error parsing GPX string:",y)}return!1}function x(){if(!T.length)return;const y=new Date().toISOString(),v=`<?xml version="1.0" encoding="UTF-8"?>
<gpx version="1.1" creator="MapDrawer" xmlns="http://www.topografix.com/GPX/1/1">
  <trk>
    <name>Manually Drawn Trace</name>
    <desc>Manually drawn trace for mapping purposes, not GPS-accurate.</desc>`,E="</trk></gpx>",S=T.map(R=>`<trkseg>
${R.getLatLngs().map(M=>`<trkpt lat="${M.lat.toFixed(6)}" lon="${M.lng.toFixed(6)}"><time>${y}</time></trkpt>`).join(`
`)}
</trkseg>`).join(`
`),k=`${v}
${S}
${E}`,C=new Blob([k],{type:"application/gpx+xml"}),D=URL.createObjectURL(C),A=document.createElement("a");A.href=D,A.download="drawing.gpx",A.click(),URL.revokeObjectURL(D)}return{loadDrawingFromGpx:h}}function Pe(e){const o=L.DomUtil.create("div","leaflet-bottom-center leaflet-bar leaflet-control");o.style.backgroundColor="white",o.style.padding="4px",o.style.borderRadius="4px",o.style.minWidth="250px",o.style.display="flex",o.style.gap="4px",o.style.boxShadow="0 1px 4px rgba(0,0,0,0.3)",o.style.alignItems="center";const t=L.DomUtil.create("input","",o);t.type="text",t.placeholder="Enter lat, lon",t.style.flex="1",t.style.border="none",t.style.outline="none",t.style.padding="4px";const a=L.DomUtil.create("button","",o);a.textContent="Go",a.style.cursor="pointer",a.style.padding="4px 8px",a.disabled=!0;const n=L.DomUtil.create("button","",o);n.textContent="×",n.style.cursor="pointer",n.style.padding="4px 8px",n.style.display="none";const l=L.Control.extend({onAdd:function(){return o},onRemove:function(){}});new l({position:"bottomleft"}).addTo(e),L.DomEvent.disableClickPropagation(o),L.DomEvent.disableScrollPropagation(o);let s;function r(f,m){const h=new URL(window.location.href);h.searchParams.set("coord",`${f},${m}`),h.hash=window.location.hash,window.history.replaceState({},"",h)}function g(){const f=new URL(window.location.href);f.searchParams.delete("coord"),f.hash=window.location.hash,window.history.replaceState({},"",f)}function u(f){t.value=p,a.disabled=!1;const m=f.split(",").map(y=>y.trim());if(m.length!==2){alert('Please enter coordinates as "lat, lon"');return}const h=parseFloat(m[0]),x=parseFloat(m[1]);if(isNaN(h)||isNaN(x)){alert("Invalid latitude or longitude");return}if(h<-90||h>90||x<-180||x>180){alert("Coordinates out of range");return}const i=[h,x];e.setView(i,15),s?s.setLatLng(i):s=L.marker(i).addTo(e),r(h,x),n.style.display=""}function b(){t.value="",a.disabled=!0,n.style.display="none",s&&(e.removeLayer(s),s=null),g()}a.addEventListener("click",()=>u(t.value)),n.addEventListener("click",b),t.addEventListener("input",()=>{const f=/^\s*-?\d+(\.\d+)?\s*,\s*-?\d+(\.\d+)?\s*$/.test(t.value.trim());a.disabled=!f}),t.addEventListener("keydown",f=>{f.key==="Enter"&&!a.disabled&&u(t.value)});const p=new URLSearchParams(window.location.search).get("coord");return p&&u(p),o.appendChild(n),{goToCoords:u}}document.addEventListener("DOMContentLoaded",()=>{O&&(document.title="🤖"+document.title);const{map:e,layersControl:o}=ke();Oe(e),Re(e);const{goToCoords:t}=Pe(e),{loadDrawingFromGpx:a}=ze(e);Ie(e,t),$e(e,o,a),Te(e),window.addEventListener("load",K),document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&K()})});
//# sourceMappingURL=index.CkkAKpmV.js.map
