(function(){const d=document.createElement("link").relList;if(d&&d.supports&&d.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))a(t);new MutationObserver(t=>{for(const o of t)if(o.type==="childList")for(const p of o.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&a(p)}).observe(document,{childList:!0,subtree:!0});function n(t){const o={};return t.integrity&&(o.integrity=t.integrity),t.referrerPolicy&&(o.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?o.credentials="include":t.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(t){if(t.ep)return;t.ep=!0;const o=n(t);fetch(t.href,o)}})();function I(){return location.hostname==="localhost"||location.hostname==="127.0.0.1"}const M="UmlkZVNhZmUyMDI1IQ==",_="rident_auth",j=30*24*60*60*1e3;function Y(){const e=localStorage.getItem(_);if(!e)return!1;try{const{password:d,expires:n}=JSON.parse(e);return d===M&&Date.now()<n}catch{return!1}}function q(){const e=Date.now()+j;localStorage.setItem(_,JSON.stringify({password:M,expires:e}))}function B(){Y()||(prompt("Enter password to view the map:")!==atob(M)&&(alert("Incorrect password. Access denied."),document.body.innerHTML="<h2 style='text-align:center;margin-top:20%'>Access Denied</h2>"),q()),document.body.classList.remove("locked")}const N={minLat:16.5,maxLat:20.5,minLon:97.5,maxLon:103},A=[[N.minLat,N.minLon],[N.maxLat,N.maxLon]],v={fast:"rgba(0, 140, 60, 1)",moderate:"rgba(255, 179, 0, 1)",slow:"rgba(255, 40, 40, 1)",veryTechnical:"rgba(128, 0, 128, 1)",maybe:"rgba(180, 180, 180, 1)",likely:"rgba(100, 100, 100, 1)",paved:"rgba(51, 102, 255, 1)"},P=L.tileLayer("http://julcnx.github.io/tiles/heatmap/ride/{z}/{x}/{y}.png?ts=1752492333523.6335",{tileSize:256,minNativeZoom:10,maxNativeZoom:13,zIndex:3}),J=L.tileLayer("../tiles/heatmap/ride/{z}/{x}/{y}.png?ts=1752492333523.6335",{tileSize:256,minNativeZoom:10,maxNativeZoom:13,zIndex:4}),z={satellite:"s",terrain:"p",hybrid:"h",maps:"m"},X=L.tileLayer(`https://mt{s}.google.com/vt?lyrs=${z.satellite}&x={x}&y={y}&z={z}`,{subdomains:["0","1","2","3"],maxNativeZoom:18}),Q=L.tileLayer(`https://mt{s}.google.com/vt?lyrs=${z.maps}&x={x}&y={y}&z={z}`,{subdomains:["0","1","2","3"],maxNativeZoom:18}),ee=L.tileLayer(`https://mt{s}.google.com/vt?lyrs=${z.terrain}&x={x}&y={y}&z={z}`,{subdomains:["0","1","2","3"],maxNativeZoom:18}),te=L.tileLayer(`https://mt{s}.google.com/vt?lyrs=${z.hybrid}&x={x}&y={y}&z={z}`,{subdomains:["0","1","2","3"],maxNativeZoom:18,transparent:!0,zIndex:2}),oe=L.esri.basemapLayer("ImageryFirefly",{maxNativeZoom:18}),ne=L.esri.basemapLayer("ImageryClarity",{maxNativeZoom:17}),ae=L.tileLayer("https://wayback.maptiles.arcgis.com/arcgis/rest/services/World_Imagery/WMTS/1.0.0/default028mm/MapServer/tile/10/{z}/{y}/{x}",{maxNativeZoom:17}),se=L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{subdomains:["a","b","c"]}),re=L.tileLayer("https://services.arcgisonline.com/arcgis/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}",{maxNativeZoom:18}),le=L.tileLayer("./50k/{z}/{x}/{y}.png",{attribution:"50K",minNativeZoom:13,maxNativeZoom:14}),ie=L.tileLayer("https://mts{s}.googleapis.com/vt?hl=en-US&lyrs=svv|cb_client:apiv3&style=40,18&x={x}&y={y}&z={z}",{subdomains:["0","1","2","3"],maxNativeZoom:13,maxZoom:20,zIndex:1,className:"overlay"}),ce=L.vectorGrid.protobuf("https://tiles.mapillary.com/maps/vtp/mly1_public/2/{z}/{x}/{y}?access_token=MLY|4100327730013843|5bb78b81720791946a9a7b956c57b7cf",{transparent:!0,maxNativeZoom:13,zIndex:1,className:"overlay",vectorTileLayerStyles:{sequence:()=>({color:"rgb(20, 150, 60)",weight:10})}}),de=L.tileLayer("https://karta-gateway.geo.azure.myteksi.net/view/api/2.0/sequence/tiles/{x}/{y}/{z}.png",{transparent:!0,minNativeZoom:13,maxNativeZoom:20,className:"overlay"});L.tileLayer("https://content-{s}.strava.com/identified/globalheat/all/hot/{z}/{x}/{y}.png?v=19",{subdomains:["a"],maxNativeZoom:16,maxZoom:20,zIndex:2,className:"overlay"});const pe=L.tileLayer("https://{s}.gps-tile.openstreetmap.org/lines/{z}/{x}/{y}.png",{transparent:!0,maxNativeZoom:18,zIndex:2,className:"overlay"}),T={"World Topo Map":re,"OSM Standard":se,"Google Maps":Q,"Google Terrain":ee};I()&&(T["RTS Map"]=le);const D={"Google Satellite":X,"ESRI Firefly":oe,"ESRI Clarity":ne,"ESRI Wayback":ae},h={"OpenStreetMap traces":pe};I()&&(h["Google Street View"]=ie,h["Google Hybrid"]=te,h.Mapillary=ce,h.KartaView=de,h["Ride NT (Dev)"]=J);let x=0;function me(e,d,n,a){const t=L.control({position:"topleft"});t.onAdd=function(){const o=L.DomUtil.create("div","leaflet-control leaflet-top-center leaflet-control-layers leaflet-control-layers-expanded transparency-toolbar"),p=L.DomUtil.create("select","",o);p.className="transparency-select",Object.keys(a).forEach(y=>{const u=document.createElement("option");u.value=y,u.textContent=y,p.appendChild(u)});const r=localStorage.getItem("rident_satellite"),i=r&&a[r]?r:Object.keys(a)[0];p.value=i;let l=a[i];l.addTo(e),l.setOpacity(x/100),l.setZIndex(1);const c=L.DomUtil.create("input","",o);return c.className="transparency-slider",c.type="range",c.min=0,c.max=100,c.step=1,c.value=x,L.DomEvent.on(c,"input",y=>{x=parseFloat(y.target.value),l&&l.setOpacity(x/100),c.blur()}),L.DomEvent.on(p,"change",y=>{const u=y.target.value;e.hasLayer(l)&&e.removeLayer(l),l=a[u],l.addTo(e),l.setOpacity(x/100),l.setZIndex(1),localStorage.setItem("rident_satellite",u)}),L.DomEvent.disableClickPropagation(o),p.blur(),o},t.addTo(e)}const R="rident_map_view",G="rident_base_layer",U="rident_satellite",W="rident_overlays";function ye(){document.getElementById("map").style.display="block";const e=ue();ge(e);const d=L.control.layers(T,h,{collapsed:!0,autoZIndex:!1,position:"topright"}).addTo(e),n=fe(e,T,h,D);return he(e,T,h),{map:e,mainOverlay:P,baseLayers:T,satelliteLayers:D,overlays:h,currentBaseLayer:n,layersControl:d}}function ue(){return L.map("map",{minZoom:9,maxBounds:L.latLngBounds(A),layers:[P],zoomControl:!0,maxZoom:18,attributionControl:!1})}function ge(e){const d=location.hash.match(/^#(\d+)\/([-\d.]+)\/([-\d.]+)$/);if(d){const a=+d[1],t=+d[2],o=+d[3];e.setView([t,o],a);return}const n=localStorage.getItem(R);if(n)try{const{center:a,zoom:t}=JSON.parse(n);e.setView(a,t);return}catch{}e.setView([18.79,98.98],10)}function fe(e,d,n,a){let t;const o=localStorage.getItem(G);o&&d[o]?(d[o].addTo(e),t=d[o]):(d["World Topo Map"].addTo(e),t=d["World Topo Map"]);const p=localStorage.getItem(W);let r=[];try{r=p?JSON.parse(p):[]}catch{}if(r.length)for(const[c,y]of Object.entries(n))r.includes(c)&&y.addTo(e);const i=localStorage.getItem(U);let l;return i&&a[i]?l=a[i]:l=a["Google Satellite"],l&&(l.setOpacity(x/100),l.addTo(e)),t}function he(e,d,n){e.on("baselayerchange",a=>{const t=Object.entries(d).find(([p,r])=>r===a.layer);t&&(localStorage.setItem(G,t[0]),t[1].setZIndex(0));const o=Object.entries(D).find(([p,r])=>r===a.layer);o&&(localStorage.setItem(U,o[0]),o[1].setZIndex(1),o[1].setOpacity(x/100))}),e.on("overlayadd overlayremove",()=>{const a=Object.entries(n).filter(([t,o])=>e.hasLayer(o)).map(([t])=>t);localStorage.setItem(W,JSON.stringify(a))}),e.on("moveend zoomend",()=>{const a=e.getCenter(),t=e.getZoom(),o=`#${t}/${a.lat.toFixed(6)}/${a.lng.toFixed(6)}`;location.hash=o,localStorage.setItem(R,JSON.stringify({center:a,zoom:t}))})}function ve(e){const d=L.control({position:"bottomright"});d.onAdd=function(){const n=L.DomUtil.create("div","info legend");n.style.position="relative",n.style.transition="all 0.3s ease",n.style.fontSize="14px",n.style.color="#333",n.style.maxWidth="250px";let a=!1;function t(u){return`<span style="
				display:inline-block;
				width:14px;
				height:10px;
				margin-right:8px;
				background-color:${u};
				vertical-align:middle;
			"></span>`}const o=document.createElement("div");o.style.background="rgba(255, 255, 255, 0.95)",o.style.borderRadius="6px",o.style.padding="8px",o.style.boxShadow="0 2px 6px rgba(0,0,0,0.2)",o.style.display="none",o.style.flexDirection="column";const p=document.createElement("div");p.style.display="flex",p.style.justifyContent="space-between",p.style.alignItems="center",p.style.marginBottom="6px";const r=document.createElement("span");r.textContent="RideNT Legend",r.style.fontWeight="bold";const i=document.createElement("a");i.href="#",i.innerHTML="ðŸ”½",i.title="Collapse legend",i.style.fontSize="18px",i.style.textDecoration="none",i.style.cursor="pointer",i.style.padding="4px",i.onclick=u=>{u.preventDefault(),a=!1,y()},p.appendChild(r),p.appendChild(i);const l=document.createElement("div");l.innerHTML=`
			${t(v.paved)} Paved<br>
			${t(v.fast)} Fast dirt<br>
			${t(v.moderate)} Moderate dirt<br>
			${t(v.slow)} Slow / Technical<br>
			${t(v.veryTechnical)} Very technical<br>
			${t(v.likely)} Rural roads<br>
			${t(v.maybe)} Uncertain trails<br>
			<br>
			<span class="caption">Speeds are approximate, based on dry GPX tracks with climate & rider factors considered. Accuracy not guaranteed.</span>
		`,o.appendChild(p),o.appendChild(l);const c=document.createElement("a");c.href="#",c.innerHTML="â“",c.title="Show legend",c.style.display="none",c.style.textDecoration="none",c.style.fontSize="20px",c.style.width="36px",c.style.height="36px",c.style.textAlign="center",c.style.lineHeight="36px",c.style.borderRadius="6px",c.style.background="white",c.style.boxShadow="0 2px 6px rgba(0,0,0,0.2)",c.style.cursor="pointer",c.onclick=u=>{u.preventDefault(),a=!0,y()};function y(){o.style.display=a?"flex":"none",c.style.display=a?"none":"inline-block"}return y(),n.appendChild(o),n.appendChild(c),n},d.addTo(e)}function $(e,d=2e3){const n=document.createElement("div");n.innerText=e,n.style.position="fixed",n.style.bottom="20px",n.style.left="50%",n.style.transform="translateX(-50%)",n.style.background="rgba(0,0,0,0.8)",n.style.color="#fff",n.style.padding="8px 12px",n.style.borderRadius="6px",n.style.fontSize="14px",n.style.zIndex=9999,n.style.opacity=0,n.style.transition="opacity 0.3s ease",document.body.appendChild(n),requestAnimationFrame(()=>{n.style.opacity=1}),setTimeout(()=>{n.style.opacity=0,setTimeout(()=>{document.body.removeChild(n)},300)},d)}function xe(e,d,n){const a=document.getElementById("context-menu");function t(r,i){const l=document.createElement("div");l.innerText=r,l.style.padding="4px 8px",l.style.cursor="pointer",l.onmouseenter=()=>l.style.background="#eee",l.onmouseleave=()=>l.style.background="",l.onmousedown=()=>{i(),a.style.display="none"},a.appendChild(l)}function o(){const r=document.createElement("hr");r.style.margin="0",a.appendChild(r)}e.on("contextmenu",function(r){const i=r.latlng.lat.toFixed(6),l=r.latlng.lng.toFixed(6),c=e.getZoom();a.innerHTML="",t("Edit in OpenStreetMap",()=>{window.open(`https://www.openstreetmap.org/id?#map=${Math.max(16,e.getZoom())}/${i}/${l}`)}),o(),t("Open in Google Maps",()=>{const y=n===d["Google Satellite"],u=new URLSearchParams({api:1,map_action:"map",basemap:y?"satellite":"terrain",center:[i,l].join(","),zoom:c});window.open(`https://www.google.com/maps/@?${unescape(u)}`)}),t("Open in Google Street View",()=>{window.open(`https://www.google.com/maps?q=&layer=c&cbll=${i},${l}`)}),t("Open in Komoot",()=>{window.open(`https://www.komoot.com/plan/@${i},${l},${c}z?sport=mtb`)}),I()&&t("Open in Mapillary",()=>{const y=new URLSearchParams({lat:i,lng:l,z:c});window.open(`https://www.mapillary.com/app/?${unescape(y)}`)}),o(),t("Copy Coordinates",()=>{navigator.clipboard.writeText(`${i}, ${l}`).then(()=>{$("Coordinates copied to clipboard.")})}),t("Copy Bounding Box",()=>{const y=e.getBounds(),u=y.getSouth().toFixed(6),S=y.getEast().toFixed(6),O=y.getNorth().toFixed(6),C=y.getWest().toFixed(6),s=`${O},${C},${u},${S}`;navigator.clipboard.writeText(s).then(()=>{$("Bounding box copied to clipboard.")})}),a.style.left=r.originalEvent.pageX+"px",a.style.top=r.originalEvent.pageY+"px",a.style.display="block"});const p=()=>a.style.display="none";e.on("mousedown",p),document.addEventListener("mousedown",p)}function be(e,d,n={}){const a=e.getContainer(),t=L.latLngBounds(A);["dragenter","dragover","dragleave","drop"].forEach(o=>{a.addEventListener(o,p=>p.preventDefault(),!1)}),a.addEventListener("drop",o=>{if(o.preventDefault(),!!o.dataTransfer.files.length)for(const p of o.dataTransfer.files){if(!p.name.toLowerCase().endsWith(".gpx"))continue;const r=new FileReader;r.onload=i=>{const l=i.target.result,c=new L.GPX(l,{async:!0,polyline_options:{color:"#9400D3",weight:5,opacity:.7},gpx_options:{joinTrackSegments:!1},markers:{startIcon:null,endIcon:null}});c.on("loaded",()=>{const y=c.getBounds();if(t.intersects(y)){c.addTo(e);const u=p.name.replace(/\.gpx$/i,"");n[u]=c,d.addOverlay(c,u),e.fitBounds(y)}else alert(`GPX file "${p.name}" is outside the allowed bounds and will not be displayed.`)})},r.readAsText(p)}})}function Le(e,d,n,a,t){function o(r=!1){const i=document.getElementById("map");i.classList.contains("hide-overlays")?(i.classList.remove("hide-overlays"),d.setOpacity(1)):(i.classList.toggle("hide-overlays"),d.setOpacity(r?0:1))}function p(){const r=document.querySelector(".transparency-slider");if(!r)return;const i=parseInt(r.value,10);r.value=i===100?"0":"100",r.dispatchEvent(new Event("input",{bubbles:!0}))}document.addEventListener("keydown",r=>{const i=document.activeElement;i&&(i.tagName==="INPUT"||i.tagName==="TEXTAREA"||i.isContentEditable)||(r.key.toLowerCase()==="a"?o(!0):r.key.toLowerCase()==="q"?o(!1):r.key.toLowerCase()==="s"?p():r.key==="Delete"&&(localStorage.clear(),location.reload()))})}const f=[];function we(e){let d=null,n=!1;const a=s=>{const m=s.getZoom();return{color:"yellow",weight:Math.max(4,25-(18-m)*2),opacity:.3}},t=L.control({position:"bottomleft"});t.onAdd=function(){const s=L.DomUtil.create("div","leaflet-bar leaflet-control"),m=L.DomUtil.create("a","",s);m.href="#",m.innerHTML="ðŸ–Šï¸",m.title="Toggle highlighter",m.style.padding="6px 10px",m.style.fontSize="20px";const g=L.DomUtil.create("a","",s);g.href="#",g.innerHTML="ðŸ§½",g.title="Clear highlights",g.style.padding="6px 10px",g.style.fontSize="20px",m.onclick=b=>{b.preventDefault(),n=!n,E()},g.onclick=b=>{b.preventDefault(),f.forEach(k=>e.removeLayer(k)),f.length=0,S()},L.DomEvent.disableClickPropagation(s),L.DomEvent.disableScrollPropagation(s);function E(){n?(m.style.background="#ff0",m.style.color="black"):(m.style.background="white",m.style.color="")}return s},t.addTo(e);function o(){e.dragging.disable(),e.doubleClickZoom.disable(),e.boxZoom.disable(),e.scrollWheelZoom.disable()}function p(){e.dragging.enable(),e.doubleClickZoom.enable(),e.boxZoom.enable(),e.scrollWheelZoom.enable()}function r(s){return s.latlng?s.latlng:s.touches&&s.touches.length>0?e.containerPointToLatLng(e.mouseEventToContainerPoint(s.touches[0])):null}function i(s){if(!n)return;const m=r(s);m&&(o(),d=L.polyline([m],a(e)).addTo(e),f.push(d),s.preventDefault&&s.preventDefault())}function l(s){if(!n||!d)return;const m=r(s);m&&(d.addLatLng(m),s.preventDefault&&s.preventDefault())}function c(s){n&&d&&(d=null,n=!1,u(),S(),p()),s.preventDefault&&s.preventDefault()}e.on("mousedown",i),e.on("mousemove",l),e.on("mouseup",c);const y=e.getContainer();y.addEventListener("touchstart",i,{passive:!0}),y.addEventListener("touchmove",l,{passive:!0}),y.addEventListener("touchend",c,{passive:!0}),e.on("zoomend",()=>{f.forEach(s=>s.setStyle(a(e)))}),window.addEventListener("keydown",s=>{if(s.key.toLowerCase()==="d"&&(n=!n,u()),(s.ctrlKey||s.metaKey)&&s.key.toLowerCase()==="z"&&f.length>0){const m=f.pop();e.removeLayer(m),S()}});function u(){const s=document.querySelector('.leaflet-bar a[title="Toggle highlighter"]');s&&(n?(s.style.background="#ff0",s.style.color="black"):(s.style.background="white",s.style.color=""))}function S(){if(!f.length){O(null);return}const s=f.map(m=>polyline.encode(m.getLatLngs().map(g=>[g.lat,g.lng]))).join(";");O(s)}function O(s){const m=new URLSearchParams(window.location.search);s?m.set("data",s):m.delete("data");const g=window.location.pathname+(m.toString()?"?"+m.toString():"")+window.location.hash;window.history.replaceState(null,"",g)}function C(){const m=new URLSearchParams(window.location.search).get("data");if(!m)return;m.split(";").forEach(E=>{try{const b=polyline.decode(E).map(([H,K])=>L.latLng(H,K)),k=L.polyline(b,a(e)).addTo(e);f.push(k)}catch{console.warn("Invalid polyline segment:",E)}})}C()}I()&&(document.title="ðŸ¤–"+document.title);const{map:w,mainOverlay:F,baseLayers:V,satelliteLayers:Se,overlays:Z,currentBaseLayer:Ee,layersControl:Te}=ye();ve(w);xe(w,V,Ee);Le(w,F,Z,V["Google Satellite"]);we(w);be(w,Te,Z);me(w,F,Z,Se);window.addEventListener("load",B);document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&B()});
